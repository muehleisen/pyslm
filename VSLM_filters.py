# VSLM_filters.py
# This file returns 5th order IIR filter coefficients for A and C weighted filters for
# a given sampling frequency of 22, 44, 48, or 96 kHz.
#
#
# The filter coefficients created by generating a freq response curve in MATLAB
# The freq response curve is generated using the ANSI S1.42 and MATLAB freqs
# The filter coefficients were found by inverting freq response curve using MATLAB invfreqz
# This is far accurate than using the bilinear transform
# b coefficients are the numerators, a coefficients are the denominators

#
# 13-Oct-2018 Ralph Muehleisen


def awt_design(fs):
    # choose filter coefficients based on sampling frequency

    if abs(fs - 22050) < 0.001:

        # # From invfreqzw22k.m: Fs = 22050, Na = 5, Nb = 5, lambda = 0.994, error = 113.0
        # a = [1.00000000000000,-3.74837802777714,5.23783337602795,-3.21466146789416,0.709411128377119,0.0157951912912999]
        # b = [0.889191902904523,-3.31285539936616,4.35955166858237,-2.09344163904258,-0.0863096447182725,0.243863111640116]

        # from invfreqzw(22050, "A", 6, 256)
        # solution has lambda = 0.949, Nwt = 2.276
        a = [1.00000000000000, -3.23525109535852, 3.28457558333118, -0.414194415468062, -1.09955505015772, 0.479759840522897, -0.0153345660640344]
        b = [0.889234193433970, -2.85548906659874, 2.62132030133922, 0.284993187762480, -1.36652360495139, 0.334826613645142, 0.0916383753693233]

    elif abs(fs - 44100) < 0.001:

        # # From invfreqzw44ka.m: Fs = 44100, Na = 5, Nb = 5, lambda = 0.994, error = 2.8
        # a = [1.00000000000000,-4.14021857232242,6.65241410715381,-5.11429385484805,1.83222699947099,-0.230128669818689]
        # b = [0.629630615336601,-2.27424756934926,2.80070190814267,-1.05292646070757,-0.347415602299186,0.244257108876743]

        # # From invfreqzw.m: Fs = 44100, Na = 5, Nb = 5, lambda = 0.990, Nwt = 2.7, Nerr=64
        # a = [1.00000000000000,-4.13840203070029,6.64536329083764,-5.10403669119192,1.82559897259300,-0.228523531877525]
        # b = [0.628571718816421,-2.26685129889652,2.78171234172627,-1.02974641919058,-0.361097585293698,0.247411242838100]

        # from invfreqzw(44100, "A", 5, 256)
        # solution has lambda = 0.983, Nwt = 3.000
        a = [1.00000000000000, -4.13999273864185, 6.65153828294213, -5.11302084203033, 1.83140511497032, -0.229929807597862]
        b = [0.629531653070937, -2.27349153448086, 2.79866836058420, -1.05037240526862, -0.348952398646604, 0.244616324740948]

    elif abs(fs - 48000) < 0.001:
        # from invfreqzw(48000, "A", 5, 256)
        # solution has lambda = 0.995, Nwt = 0.000
        a = [1.00000000000000, -4.18870402796377, 6.83471973393129, -5.37062030095868, 1.99190291667506, -0.267298315149928]
        b = [0.588441147005403, -2.11013236386567, 2.55613368839817, -0.892018350742488, -0.386040643274674, 0.243616522479255]

    else:
        # from invfreqzw(96000, "A", 6, 256)
        # solution has lambda = 0.983, Nwt = 2.379
        a = [1.00000000000000, -4.85787782531434, 9.64740385606076, -9.99349621460443, 5.67498643510293, -1.66971023072488, 0.198693979657083]
        b = [0.279739283537504, -1.02734170190169, 1.30242187734479, -0.531053526070236, -0.144042919600066, 0.129831716315071, -0.00955472962537889]

    return [b, a]


def cwt_design(fs):

    if abs(fs - 22050) < 0.001:

        # # From invfreqzw22kc.m: Fs = 22050, Na = 5, Nb = 5, lambda = 0.807, Nwt = 3.0
        # a = [1.00000000000000,-2.32706596248621,1.18097948521976,0.638544521311529,-0.509389473569105,0.0169381907323940]
        # b = [0.800722904605627,-1.66781590712901,0.468299202464897,0.792459770676306,-0.322168389028272,-0.0714975816828622]

        # from invfreqzw(22050, "C", 5, 256)
        # solution has lambda = 0.763, Nwt = 0.724
        a = [1.00000000000000, -2.33357800257002, 1.17692820604849, 0.666236563226368, -0.526843937572501, 0.0172631389289934]
        b = [0.800688852595179, -1.67287600598069, 0.463441170487680, 0.814512210105256, -0.331289420729406, -0.0744768064818655]

    elif abs(fs - 44100) < 0.001:

        # # From invfreqzw44kc.m: Fs = 44100, Na = 5, Nb = 5, lambda = 0.703, Nwt = 3.0
        # a = [1.00000000000000,-1.76492323958185,0.281551806291076,0.776297308509110,-0.331586799028149,0.0386696581786348]
        # b = [0.534672453029001,-0.599379329345125,-0.374026913047091,0.388394143474471,0.0694251000364233,-0.0190854640661402]

        # from invfreqzw(44100, "C", 5, 256)
        # solution has lambda = 0.623, Nwt = 0.828
        a = [1.00000000000000, -1.79194700446352, 0.290772777494777, 0.852112206281045, -0.403135179652130, 0.0522053973871463]
        b = [0.534730284944160, -0.613987821172684, -0.378239791623185, 0.429720689397724, 0.0575345193198718, -0.0297578796536666]

    elif abs(fs - 48000) < 0.001:

        # # From invfreqzw48kc.m: Fs = 48000, Na = 5, Nb = 5, lambda = 0.724, Nwt = 3.0
        # a = [1.00000000000000,-1.80249091696846,0.365744209637157,0.718512480569713,-0.318961419234232,0.0372028430343856]
        # b = [0.497598746634710,-0.545730012788851,-0.348898661523446,0.333238436522495,0.0751303249505898,-0.0113388420746462]

        # from invfreqzw(48000, "C", 5, 256)
        # solution has lambda = 0.739, Nwt = 0.000
        a = [1.00000000000000, -1.79747427514762, 0.349687779698322, 0.736950757851382, -0.327738831157532, 0.0385817388635898]
        b = [0.497575158172561, -0.543146452439320, -0.355251620774578, 0.337396034411035, 0.0756563481503827, -0.0122294748026025]

    else:
        # # From invfreqzw96kc.m: Fs = 96000, Na = 5, Nb = 5, lambda = 0.848, Nwt = 3.0
        # a = [1.00000000000000,-3.00560922587444,3.31745841934466,-1.64266151946882,0.356123292507411,-0.0253104682153066]
        # b = [0.230209805190782,-0.406475186128799,0.108551518500445,0.0852427611185787,-0.0212903072318608,0.00376140810592195]

        # from invfreqzw(96000, "C", 5, 256)
        # solution has lambda = 0.972, Nwt = 2.379
        a = [1.00000000000000, -3.90891447551709, 5.93595678341154, -4.35350535824319, 1.53479900989879, -0.208335959414160]
        b = [0.230381801743298, -0.615777338477564, 0.458237696002224, 0.0162085561791318, -0.0959298551089417, 0.00687913966185078]

    return [b, a]
